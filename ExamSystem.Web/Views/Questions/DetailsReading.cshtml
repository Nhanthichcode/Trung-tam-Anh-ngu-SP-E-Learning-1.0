@model ExamSystem.Web.Models.ReadingDetailsViewModel

@{
    ViewData["Title"] = "Chi tiết bài đọc";
}

<style>
    /* Custom styles for independent scrolling */
    .scrollable-content {
        height: 75vh; /* Adjust height as needed */
        overflow-y: auto;
    }

    .sticky-header {
        position: sticky;
        top: 0;
        z-index: 10;
    }
</style>

<div class="container-fluid mt-4 px-4">
    @* HEADER *@
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="text-primary m-0"><i class="fa fa-book-open"></i> Chi tiết bài đọc</h3>
        <div>
            @* FIX: Use Model.Id (Reading Passage ID) instead of Question ID *@
            <a asp-action="EditReading" asp-route-id="@Model.Id" class="btn btn-warning shadow-sm">
                <i class="fa fa-pencil"></i> Sửa bài này
            </a>
            <a asp-action="Index" class="btn btn-secondary shadow-sm">
                <i class="fa fa-arrow-left"></i> Quay lại
            </a>
        </div>
    </div>

    <div class="row">
        @* LEFT COLUMN: PASSAGE CONTENT (Fixed Header, Scrollable Body) *@
        <div class="col-lg-6 mb-4">
            <div class="card border-success shadow-sm h-100">
                <div class="card-header bg-success text-white fw-bold d-flex justify-content-between sticky-header">
                    <span><i class="fa fa-align-left"></i> Nội dung bài đọc</span>
                    <span class="badge bg-white text-success">Level @Model.Level</span>
                </div>
                <div class="card-body bg-light p-0">
                    <div class="scrollable-content p-3">
                        @* Passage Title *@
                        @if (!string.IsNullOrEmpty(Model.Title))
                        {
                            <h5 class="card-title text-success fw-bold mb-3">@Model.Title</h5>
                        }

                        @* Passage Content *@
                        <div class="p-3 bg-white rounded border"
                             style="white-space: pre-line; font-family: 'Segoe UI', serif; line-height: 1.8; color: #2c3e50; font-size: 1.05rem;">
                            @Model.PassageText
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @* RIGHT COLUMN: QUESTIONS LIST (Fixed Header, Scrollable Body) *@
        <div class="col-lg-6">
            <div class="card border-secondary shadow-sm h-100">
                <div class="card-header bg-secondary text-white fw-bold sticky-header">
                    <i class="fa fa-list-ol"></i> Danh sách câu hỏi (@(Model.Questions?.Count ?? 0) câu)
                </div>
                <div class="card-body bg-light p-0">
                    <div class="scrollable-content p-3">
                        @if (Model.Questions != null && Model.Questions.Any())
                        {
                            int i = 1;
                            foreach (var q in Model.Questions)
                            {
                                <div class="card mb-3 border-0 shadow-sm">
                                    <div class="card-header bg-white border-bottom fw-bold text-primary">
                                        <i class="fa fa-question-circle"></i> Câu hỏi @i
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text fw-bold mb-3">@q.Content</p>

                                        @if (q.Answers != null && q.Answers.Any())
                                        {
                                            <ul class="list-group list-group-flush mb-3 rounded border">
                                                @foreach (var ans in q.Answers)
                                                {
                                                    var itemClass = ans.IsCorrect ? "list-group-item-success fw-bold" : "";
                                                    <li class="list-group-item @itemClass d-flex justify-content-between align-items-center">
                                                        <span>@ans.Content</span>
                                                        @if (ans.IsCorrect)
                                                        {
                                                            <i class="fa fa-check-circle text-success"></i>
                                                        }
                                                    </li>
                                                }
                                            </ul>
                                        }
                                        else
                                        {
                                            <div class="alert alert-warning small py-1"><i class="fa fa-exclamation-triangle"></i> Chưa có đáp án.</div>
                                        }

                                        @if (!string.IsNullOrEmpty(q.Explaination))
                                        {
                                            <div class="alert alert-info p-2 small mb-0 border-info">
                                                <strong><i class="fa fa-info-circle"></i> Giải thích:</strong> @q.Explaination
                                            </div>
                                        }
                                    </div>
                                </div>
                                i++;
                            }
                        }
                        else
                        {
                            <div class="alert alert-secondary text-center mt-3">
                                Chưa có câu hỏi trắc nghiệm nào được thêm vào bài đọc này.
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>