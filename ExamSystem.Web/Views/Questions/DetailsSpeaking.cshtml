@model ExamSystem.Core.Entities.Question
@using ExamSystem.Core.Enums

@{
    ViewData["Title"] = "Chi tiết bài NÓI";
}

<div class="container mt-4">
    <div class="card border-danger shadow-sm">
        <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center">
            <h4 class="m-0"><i class="fa fa-microphone"></i> Chi tiết bài NÓI #@Model.Id</h4>
            <span class="badge bg-white text-danger">@Model.Type</span>
        </div>
        <div class="card-body">
            <div class="row">
                @* --- CỘT TRÁI: NỘI DUNG & MEDIA --- *@
                <div class="col-md-7">
                    <div class="mb-4">
                        <h5 class="text-danger border-bottom border-danger pb-2"><i class="fa fa-question-circle"></i> Nội dung / Yêu cầu</h5>
                        <div class="p-3 bg-white rounded border shadow-sm">
                            <div class="fs-5 text-dark" style="white-space: pre-line; line-height: 1.6; font-family: 'Segoe UI', sans-serif;">
                                @Model.Content
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <h5 class="text-danger border-bottom border-danger pb-2"><i class="fa fa-photo"></i> Media đính kèm</h5>
                        <div class="text-center bg-dark bg-opacity-10 p-4 rounded">
                            @if (!string.IsNullOrEmpty(Model.MediaUrl))
                            {
                                @if (Model.MediaUrl.EndsWith("mp3") || Model.MediaUrl.EndsWith("wav"))
                                {
                                    <div class="card p-3">
                                        <label class="mb-2 fw-bold text-start">File Nghe:</label>
                                        <audio controls src="@Model.MediaUrl" class="w-100"></audio>
                                    </div>
                                }
                                else
                                {
                                    <img src="@Model.MediaUrl" class="img-fluid rounded shadow" style="max-height: 400px; object-fit: contain;" alt="Speaking Image" />
                                }
                                <div class="mt-2 text-muted small"><i class="fa fa-link"></i> Nguồn: @Model.MediaUrl</div>
                            }
                            else
                            {
                                <div class="text-muted fst-italic">Không có file nghe hoặc hình ảnh đính kèm.</div>
                            }
                        </div>
                    </div>
                </div>

                @* --- CỘT PHẢI: THÔNG TIN BỔ SUNG --- *@
                <div class="col-md-5">
                    <div class="card bg-light border-0 h-100">
                        <div class="card-body">
                            <h5 class="card-title text-secondary fw-bold">Thông tin quản lý</h5>
                            <hr />

                            <div class="mb-3">
                                <label class="fw-bold text-muted small">ĐỘ KHÓ</label>
                                <div>
                                    <span class="badge bg-warning text-dark fs-6 px-3">Level @Model.Level</span>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="fw-bold text-muted small">CHỦ ĐỀ (TOPICS)</label>
                                <div>
                                    @if (Model.QuestionTopics != null && Model.QuestionTopics.Any())
                                    {
                                        foreach (var qt in Model.QuestionTopics)
                                        {
                                            <span class="badge bg-info text-dark me-1 mb-1">@qt.Topic?.Name</span>
                                        }
                                    }
                                    else
                                    {
                                        <span class="text-muted fst-italic">Chưa phân loại</span>
                                    }
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="fw-bold text-muted small">GHI CHÚ / GIẢI THÍCH</label>
                                <div class="p-2 bg-white border rounded text-secondary small">
                                    @(string.IsNullOrEmpty(Model.Explaination) ? "Không có ghi chú." : Model.Explaination)
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="fw-bold text-muted small">NGÀY TẠO</label>
                                <div>@Model.CreatedDate.ToString("dd/MM/yyyy HH:mm")</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-footer bg-light d-flex justify-content-between py-3">
            <a asp-action="Index" class="btn btn-secondary shadow-sm"><i class="fa fa-arrow-left"></i> Quay lại danh sách</a>
            <div>
                <a asp-action="EditSpeaking" asp-route-id="@Model.Id" class="btn btn-warning shadow-sm fw-bold me-2"><i class="fa fa-pencil"></i> Sửa bài này</a>
                <a asp-action="Delete" asp-route-id="@Model.Id" class="btn btn-outline-danger shadow-sm"><i class="fa fa-trash"></i> Xóa</a>
            </div>
        </div>
    </div>
</div>