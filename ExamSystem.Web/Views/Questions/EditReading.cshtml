@model ExamSystem.Web.Models.QuestionViewModel

@{
    ViewData["Title"] = "Chỉnh sửa bài đọc";
}

<div class="container mt-4">
    <div class="card border-warning shadow">
        <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
            <h4 class="m-0"><i class="fa fa-pencil-square-o"></i> Chỉnh sửa toàn bộ bài đọc</h4>
            <a asp-action="Index" class="btn btn-sm btn-dark"><i class="fa fa-arrow-left"></i> Hủy</a>
        </div>
        <div class="card-body">          
                <form asp-action="EditReading" method="post" onsubmit="return questionEditor.validateForm()">
                <div class="row mb-3">
                    <div class="col-md-9">
                        <label class="fw-bold text-success"><i class="fa fa-book"></i> Nội dung bài đọc (Sửa ở đây sẽ cập nhật cho tất cả câu hỏi)</label>
                        <textarea asp-for="PassageText" class="form-control border-success" rows="8" required></textarea>
                    </div>
                    <div class="col-md-3">
                        <label class="fw-bold">Độ khó chung</label>
                        <select asp-for="Level" class="form-select">
                            <option value="1">Dễ</option>
                            <option value="2">Vừa</option>
                            <option value="3">Khó</option>
                        </select>
                    </div>
                </div>

                <hr />
                <h5 class="text-primary mb-3">Danh sách câu hỏi chi tiết</h5>

                <div id="SubQuestionsContainer">
                    @* Trong EditReading.cshtml *@
                    @for (int i = 0; i < Model.SubQuestions.Count; i++)
                    {
                        <div class="card mb-3">
                            <div class="card-header">
                                <strong>Câu hỏi số @(i + 1)</strong>
                                <input type="hidden" name="SubQuestions[@i].Id" value="@Model.SubQuestions[i].Id" />
                            </div>
                            <div class="card-body">
                                <input class="form-control mb-2" name="SubQuestions[@i].Content" value="@Model.SubQuestions[i].Content" placeholder="Nội dung câu hỏi" />
                                <div class="row g-2">
                                    <div class="col-6"><input class="form-control" name="SubQuestions[@i].OptionA" value="@Model.SubQuestions[i].OptionA" placeholder="A" /></div>
                                    <div class="col-6"><input class="form-control" name="SubQuestions[@i].OptionB" value="@Model.SubQuestions[i].OptionB" placeholder="B" /></div>
                                    <div class="col-6"><input class="form-control" name="SubQuestions[@i].OptionC" value="@Model.SubQuestions[i].OptionC" placeholder="C" /></div>
                                    <div class="col-6"><input class="form-control" name="SubQuestions[@i].OptionD" value="@Model.SubQuestions[i].OptionD" placeholder="D" /></div>
                                </div>
                                <div class="mt-2">
                                    Đáp án đúng:
                                    <select name="SubQuestions[@i].CorrectAnswer" class="form-select w-auto d-inline">
                                        <option value="A" selected="@(Model.SubQuestions[i].CorrectAnswer == "A")">A</option>
                                        <option value="B" selected="@(Model.SubQuestions[i].CorrectAnswer == "B")">B</option>
                                        <option value="C" selected="@(Model.SubQuestions[i].CorrectAnswer == "C")">C</option>
                                        <option value="D" selected="@(Model.SubQuestions[i].CorrectAnswer == "D")">D</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    }
                </div>

                <div class="d-flex justify-content-between mt-4">
                    <button type="button" class="btn btn-outline-primary" onclick="questionEditor.addRow()">Thêm câu hỏi</button>
                    <button type="submit" class="btn btn-warning btn-lg px-5 shadow">
                        <i class="fa fa-save"></i> CẬP NHẬT TẤT CẢ
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script src="~/js/question-editor.js"></script>

    <script>
        // Khởi chạy script khi trang load xong
        document.addEventListener('DOMContentLoaded', function() {
            // Truyền vào số lượng câu hỏi hiện tại để biến đếm bắt đầu chính xác
            // Tham số 2 là ID của div chứa danh sách câu hỏi
            questionEditor.init(@Model.SubQuestions.Count, 'SubQuestionsContainer');
        });
    </script>
}